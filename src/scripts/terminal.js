document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("user-input"),t=document.getElementById("output"),n=document.getElementById("prompt-line"),o="",r=!1,s="",l="",a="",i="",c="",$="",g="",u="";function d(t){r=t,n.style.display=t?"flex":"none",t&&e.focus(),document.getElementById("terminal").scrollTop=document.getElementById("terminal").scrollHeight}let h=document.getElementById("troy");function y(e,t=500){let n=parseFloat(getComputedStyle(h).opacity),o=performance.now();function r(s){let l=Math.min((s-o)/t,1);h.style.opacity=n+(e-n)*l,l<1&&requestAnimationFrame(r)}requestAnimationFrame(r)}function p(e,t){let n="";for(let o=0;o<e.length;o++){let r=e.charCodeAt(o);if(r<32||r>126){n+=e[o];continue}let s=t.charCodeAt(o%t.length),l=(r-32+(s-32))%95;n+=String.fromCharCode(l+32)}return n}function f(e,t){let n="";for(let o=0;o<e.length;o++){let r=e.charCodeAt(o);if(r<32||r>126){n+=e[o];continue}let s=t.charCodeAt(o%t.length),l=r-32-(s-32);l<0&&(l+=95),n+=String.fromCharCode(l+32)}return n}async function m(e){let t=new TextEncoder,n=t.encode(e),o=await crypto.subtle.digest("SHA-256",n),r=Array.from(new Uint8Array(o)),s=r.map(e=>e.toString(16).padStart(2,"0")).join("");return s}function _(e,n,o=15,r=35,s=2e3,l="#FFFFFF"){d(!1);let a=document.createElement("div");t.appendChild(a),a.style.color=l;let i=null,c=0,$=0,g=e.indexOf("\xa7");function u(){c=(c+1)%4,a.innerHTML=e.slice(0,g)+".".repeat(c)}!function t(){if($<e.length){if("\xa7"===e[$]){i=setInterval(u,400),$++,setTimeout(t,0);return}$!==g&&(a.innerHTML=e.slice(0,$+1),$++,document.getElementById("terminal").scrollTop=document.getElementById("terminal").scrollHeight,setTimeout(t,o+Math.random()*(r-o)))}else i?setTimeout(()=>{clearInterval(i),a.innerHTML=e.replace("\xa7","..."),n&&n()},s):n?n():d(!0)}()}function v(e,t,n=365){let o=new Date(Date.now()+864e5*n).toUTCString();document.cookie=`${e}=${encodeURIComponent(t)}; expires=${o}; path=/`}function b(e){let t=document.cookie.split(";");for(let n of t){let[o,r]=n.trim().split("=");if(o===e)return decodeURIComponent(r)}return null}function k(){document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")})}function E(e){document.body.style.color=e;let t=document.querySelector(".terminal");t&&(t.style.borderColor=e),document.querySelectorAll(".prompt").forEach(t=>{t.style.color=e}),document.querySelectorAll(".cursor").forEach(t=>{t.style.color=e})}let I=!1,x=!1,w=!1,C=!1;function L(t){"true"===b("seenStatus")&&(w=!0),"true"===b("troyCommandEnabled")&&(C=!0),e.textContent="",o="";var n=t.split(" ");let r=t.toLowerCase(),h=[];if(n.length>0&&(r=n[0].toLowerCase(),h=n.slice(1)),I){x?_("Decryption Key is suitable, but may not be correct. Attempting to decrypt log\xa7",()=>{let e=f(u,r);m(e).then(t=>{console.log(t),"95fc666c0383430428c8ad8a249870ad40c31a5fd49fa667bf97adb34174cd16"==t?(I=!1,_("Successfully Decrypted Log!\n"+e,()=>{d(!0)},5,10)):_("Decryption Key is incorrect. Please try again later.",()=>{I=!1,d(!0)},5,10)})},5,10):_("Decryption Key is suitable, but may not be correct. Attempting to decrypt log\xa7",()=>{let e=f(g,r);m(e).then(t=>{console.log(t),"65e351280687c743fbf3d55504f196dcb311d621567725ca06b7cd42c7411a83"==t?_("Successfully Decrypted Log!\n"+e,()=>{if("true"===b("seenLog7")){d(!0);return}setTimeout(()=>{I=!1,"true"!==b("seenLog7")?_("Message recieved by unknown sender. Patching through message\xa7",()=>{A(),_("I see you've gained access to an access terminal. They were all supposed to have been destr<strong>o</strong>yed, but I guess one slipped through the cracks.",()=>{setTimeout(()=>{_("I am the last survivor of the Nova Agen<strong>c</strong>y. I hop<strong>e</strong> you understand the e<strong>x</strong>treme gravity of the situation.",()=>{setTimeout(()=>{_("The virus has spread beyond our control. There <strong>i</strong>s nothing el<strong>s</strong>e we can do.",()=>{setTimeout(()=>{_("I have transferred you one last log from my internal filesyste<strong>m</strong>.",()=>{setTimeout(()=>{v("seenLog7","true"),_("Transmission finished. (1) new log(s) recieved.",()=>{setTimeout(()=>{A(),d(!0)},1e3)},5,10)},2e3)},45,50)})},45,50)},2e3)},45,50)},2e3)},45,50)},5,10,4e3):d(!0)},1e4)},5,10):_("Decryption Key is incorrect. Please try again later.",()=>{I=!1,d(!0)},5,10)})},5,10,5e3);return}if("help"===r)_("Available commands: help, clear, status, log"+(C?", troy":"")+("true"===b("seenLog7")?", transmission":""),()=>{d(!0)},5,10);else if("reset"===r)k();else if("clear"===r)A();else if("transmission"===r&&"true"===b("seenLog7"))_("Message recieved by unknown sender. Patching through message\xa7",()=>{A(),_("I see you've gained access to an access terminal. They were all supposed to have been destr<strong>o</strong>yed, but I guess one slipped through the cracks.",()=>{setTimeout(()=>{_("I am the last survivor of the Nova Agen<strong>c</strong>y. I hop<strong>e</strong> you understand the e<strong>x</strong>treme gravity of the situation.",()=>{setTimeout(()=>{_("The virus has spread beyond our control. There <strong>i</strong>s nothing el<strong>s</strong>e we can do.",()=>{setTimeout(()=>{_("I have transferred you one last log from my internal filesyste<strong>m</strong>.",()=>{setTimeout(()=>{v("seenLog7","true"),_("Transmission finished. (1) new log(s) recieved.",()=>{setTimeout(()=>{A(),d(!0)},1e3)},5,10)},2e3)},45,50)})},45,50)},2e3)},45,50)},2e3)},45,50)},5,10,4e3);else if("status"===r)_("Nova Surveilence System Status: Offline",()=>{setTimeout(()=>{_("Last Connection: 12/2/2024 14:32:45",()=>{},5,10),_("Last Message: Massive quake detected, lack of Nova life signals warrants usage of emergency shutdown protocol. Shutting down.\nThe (7) most recent log(s) have been uploaded to the system.",()=>{d(!0),w=!0,v("seenStatus","true")},5,10)},500)},5,10);else if("log"===r||"logs"===r){if(!w){_("Error: Logs are currently unavailable. Please check system status.",()=>{d(!0)},5,10);return}if(0===h.length&&_("Available logs: 1, 2, 3, 4, 5, 6, 7"+("true"===b("seenLog7")?", 8":""),()=>{d(!0)},5,10),h.length>0){let p=parseInt(h[0]);switch(p){case 1:_(s,()=>{d(!0)},5,10);break;case 2:_(l,()=>{d(!0)},5,10);break;case 3:_(a,()=>{d(!0)},5,10);break;case 4:_(i,()=>{d(!0)},5,10);break;case 5:_(c,()=>{d(!0)},5,10);break;case 6:y(.05,1e3),_($,()=>{setTimeout(()=>{d(!0),y(0,1e3)},4e3)},25,30,0,"#DA012E"),v("customName","Intruder"),v("troyCommandEnabled","true"),C=!0;break;case 7:I=!0,_("Log Encrypted: Please enter decryption key.",()=>{d(!0)},5,10);break;case 8:if("true"!==b("seenLog7")){_("Invalid log number.",()=>{d(!0)},5,10);return}I=!0,x=!0,_("Log Encrypted: Please enter decryption key.",()=>{d(!0)},5,10);break;default:_("Invalid log number.",()=>{d(!0)},5,10)}}}else if("troy"===r&&C){let E=["fuck you.","take off your skin!","did you know if you laid out all your blood vessels from end to end, you would be dead? facinating!","have you ever heard of the secret letter phenomenon? apparently, the letter d is pretty secret!","kill yourself!","press Alt+F4 for the next secret!","Did you know if you open file explorer, and delete the folder C:\\Windows\\System32, it'll give you a clue for the next secret?","Ruina Mentis is the greatest insanity song. I love that black and red guy!",`                                                            
                                         ************     *#                            
                                   **@@@@%%@@@@@@@@@@@@* *@@*                           
                                 *@@@@@@%@@@*@@@@@@@@@@*@@@@@*                          
                               *@@@@@@@@*@@@@@*@@@@@*@@@@@@@@@*                         
                              *@@@@@@@@@*@@@@@*@*%@@@@@@@@@@@@@*                        
                        %    *@@@@@@@@@*@@@@@@@@@@@@@@@@@@@@@@@*                        
                        %%   %@@@@@@@@*@@@@@@@@@@@@@@@@@@@@@@@@%                        
                        %%%%%%@@@@@@@#@@@@@@@@@@@@@@@@@@@@@@@@*                         
                         @%@@%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@* *  *%*                    
                        @%%%%@%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*                     
                        @%%%%%%%%%@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@                       
                        @%%%%%%%%%@@@@@@@@@@*@@@@@@%%%%@@@@@@@@@                        
                        @%%%%@*@@@@@@@@@@@@@@%@*%%%%%%%%@@@@@@%                         
                        @%%%%%@@@@@@@@@@@@@@%%%%%%%@@@@@@@@@*                           
                     @@@%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@**@*                          
               @@@@@@%%@%%%%%%#@*@@%@@@@@@@@@@@@@@@@@%@@@*@*                            
              @@%%%%%@@@@%%%%%@@@@@@@%@%@%@@@@@@%@%@@@@@*                               
              @@%%@@@%%%@%%%%%@@%%%@@**@%@@@@@@@@@@#@@*#*                               
              @@@@@%%%%%%%%%%%@@%%%%@%%%@#********@@#@@@@@@**                           
              @@@@%%%%%%%@%%%%%@%%%%%%%%%@@@@@@@@%@@@@@@@@@***                          
               @@@@%%%%%%%@%%%%@%%%%%@%%%@#@@@@@*@@@@@@@@*@*                            
                @@@@%%%%%@@%%%%@%%%%%@%%%%@@%**@*%%@@@@@@@@@@*                          
                @@@@%%%%%%%%%%%%@%%%%%@%%%@*@@@@%@@@@@@@@@@@@@@                         
                @@@@@%%%%%%%%%%%@@%%%%@%%@@*%@@@@%@@@@@@@@@@@@@@*                       
                 @@@@%%%%%%%%%%%@@%%%%@%%@@@%@@@@%@@@@@@@@@@@@@@@*                      
                  @@@@%%@@@@%%%%@@@@@@@@@@%@@@@%@%%@@@@@@@@@@@@@@@@*                    
                    @@@@@@@@@@@@@@@@@@@@@@@@@@@%@%%@@@@@@@@@@@@@@@@@@                   
                     @@@@@@@@@@@@@@                                                     
                       @@@@@@@@@                                                        `,],L=Math.floor(Math.random()*E.length),T=E[L],S=25,B=30;L===E.length-1&&(S=5,B=10),y(.05,300),_(T,()=>{d(!0),y(0,500)},S,B,0,"#DA012E")}else _(`Unknown command: ${r}`,()=>{d(!0)},5,10)}function T(e,t){t("101%")}function A(){t.innerHTML="",o="",e.textContent=""}function S(){let e=b("customName")||"Guest";_(`Nova Access Terminal (Ver 7.3) - Welcome, ${e}!`,()=>{},5,10),_("Type 'help' to see available commands.",()=>{},5,10),d(!0)}fetch("scripts/logs/chapter1.txt").then(e=>e.text()).then(e=>{s=e}),fetch("scripts/logs/chapter2.txt").then(e=>e.text()).then(e=>{l=e}),fetch("scripts/logs/chapter3.txt").then(e=>e.text()).then(e=>{a=e}),fetch("scripts/logs/chapter4.txt").then(e=>e.text()).then(e=>{i=e}),fetch("scripts/logs/chapter5.txt").then(e=>e.text()).then(e=>{c=e}),fetch("scripts/logs/chapter6.txt").then(e=>e.text()).then(e=>{$=e.split("⠀")[0]}),fetch("scripts/logs/chapter7.txt").then(e=>e.text()).then(e=>{g=e}),fetch("scripts/logs/chapter8.txt").then(e=>e.text()).then(e=>{u=e}),"true"===b("seenIntro2")?S():_("Attempting to boot Nova Access Terminal (Ver 7.3)\xa7",()=>{_("Failed to connect to Nova Access Server.",()=>setTimeout(()=>{_("Attempting to connect to backup access server\xa7",()=>{_("Failed to connect to backup access server.",()=>setTimeout(()=>{_("Searching for inactive access servers to check connection status\xa7",()=>{T("http://localhost:3000/server-status",e=>{_("Found (1) inactive access server(s). Determining connection status\xa7",()=>{_("Connection Status: Active",()=>setTimeout(()=>{_(`Connecting\xa7`,()=>{A(),S()},5,10,4e3),v("seenIntro2","true")},500),5,10)},5,10,3e3)})},5,10,7e3)},2e3),5,10)},5,10,5e3)},1e3),5,10)},5,10,5e3),window.addEventListener("keydown",n=>{if(r&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&(!(n.key.length>1)||"Backspace"===n.key||"Enter"===n.key)){if("Backspace"===n.key)o=o.slice(0,-1),document.getElementById("terminal").scrollTop=document.getElementById("terminal").scrollHeight;else if("Enter"===n.key){let s=document.createElement("div");s.textContent="> "+o,t.appendChild(s),document.getElementById("terminal").scrollTop=document.getElementById("terminal").scrollHeight,L(o),o=""}else 1===n.key.length&&(o+=n.key,document.getElementById("terminal").scrollTop=document.getElementById("terminal").scrollHeight);e.textContent=o}})});